# OpsSightAI Helm Chart Values

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

# Namespace configuration
namespace:
  create: true
  name: opssightai

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 2
  
  image:
    repository: opssightai-frontend
    tag: latest
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  env:
    REACT_APP_API_URL: http://opssightai-backend:4000
    NODE_ENV: production

# Backend configuration
backend:
  enabled: true
  replicaCount: 3
  
  image:
    repository: opssightai-backend
    tag: latest
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 4000
    targetPort: 4000
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  env:
    NODE_ENV: production
    PORT: "4000"
    DB_HOST: opssightai-database
    DB_PORT: "5432"
    DB_NAME: opssightai
    DB_USER: postgres
  
  secrets:
    # These should be provided via --set or external secret management
    dbPassword: ""
    jwtSecret: ""

# Database configuration (TimescaleDB)
database:
  enabled: true
  
  image:
    repository: timescale/timescaledb
    tag: latest-pg15
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
  
  persistence:
    enabled: true
    storageClass: ""  # Use default storage class
    accessMode: ReadWriteOnce
    size: 20Gi
  
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  
  env:
    POSTGRES_DB: opssightai
    POSTGRES_USER: postgres
  
  secrets:
    # Should be provided via --set or external secret management
    postgresPassword: ""

# Ingress configuration
ingress:
  enabled: true
  className: "alb"  # Use "gce" for GKE
  annotations:
    # AWS ALB annotations
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:region:account:certificate/cert-id
    
    # GCP GKE annotations (uncomment for GKE)
    # kubernetes.io/ingress.class: gce
    # kubernetes.io/ingress.global-static-ip-name: opssightai-ip
    # networking.gke.io/managed-certificates: opssightai-cert
  
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: opssightai-frontend
              port: 80
        - path: /api
          pathType: Prefix
          backend:
            service:
              name: opssightai-backend
              port: 4000
  
  tls: []
  # - secretName: opssightai-tls
  #   hosts:
  #     - opssightai.yourdomain.com

# Security configuration
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
    - ALL

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Network Policy
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress

# Service Monitor for Prometheus
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s

# Node affinity and tolerations
nodeSelector: {}
tolerations: []
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - opssightai
        topologyKey: kubernetes.io/hostname
